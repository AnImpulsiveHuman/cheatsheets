# Vault

Install vault
-------------
```
wget https://releases.hashicorp.com/vault/1.5.5/vault_1.5.5_linux_amd64.zip
unzip vault_1.5.5_linux_amd64.zip
mv vault /usr/bin
```
Starting the dev server
-----------------------
```
vault server -dev
export VAULT_ADDR = '<addr>'
export VAULT_TOKEN = '<root token>'
vault status                             -> shows the status
```
Vault kv (key value)
--------------------
```
vault kv put secret/<path> <key>=<value>          -> add a key value (kv) secret (overwrites any data present)

NOTE: adding to the same path keeps creating a new version, overwriting pre-exisiting data at the path

vault kv get secret/<path>                        -> prints all the keys in the path
vault kv get -field=<key> secret/<path>           -> prints only the specified field
vault kv delete secret/<path>                     -> deletes the keys in the path

NOTE: doesnt actually delete it. marks it as deleted so it is not shown in get requests

vault kv undelete -versions=<num> secret/<path>   -> undos the delete of the specified version
vault kv list secret/<path>                       -> lists the keys in the path
vault kv destroy -versions=<num> secret/<path>    -> premanently deletes the specified version of the path
vault kv rollback -version=<num> secret/<path>    -> rolls back to the specified version 

NOTE:creates a new verison with the data of the version to be rolled back(ex. rolling back to version 2 from 3 will create a new version 4 with the data of version 2)

vault kv metadata get secret/<path>               -> gets the metadata of all the versions of the key at the path
vault kv metadata put secret/<path>               -> create a blank key (adds only the metadata without any data)
options:
.......
-max-versions=<num>                               -> sets the max version after which the oldest version is destroyed (premanently deleted)
-delete-version-after=<hrs ms secs>               -> if its set, all the versions will be deleted after the specified time duration

vault kv patch secret/<path> <key>=<value>        -> adds additional keys to the path (appends to the present data)
```
Vault secrets
-------------
```
vault secrets enable -path=<path> <type>   -> starts the specified type of secrets engine at the specified path
vault secrets disble <path>                -> disables the secret engine at the specified path
vault secrets list                         -> lists the enables secret engines
```
AWS secrets
-----------
```
vault secrets enable -path=<path> aws
vault write aws/config/root access_key <access key> secret_key <secret key> region=<region>             -> configure vault to use aws
vault write aws/role/<role name> credential_type=<credential type> policy_document=-<<EOF <policy> EOF  -> create a role and attach a policy
vault read aws/role/<role name>                                                                         -> generate the new access and secret access key
vault lease revoke <lease id>                                                                           -> revoke the specified secret
```
Token
-----
```
vault login <token>                       -> login using a token
vault token create                        -> create a new token
vault token create -policy=<policy name>  -> create a new token with the given policy
vault token revoke <token>                -> revoke the given token
vault token revoke -mode path <path>      -> revoke all the tokens generated by the path
```
Authentication
--------------
```
vault auth enable <auth type>       -> enable github authentication at path= auth/github
vault auth disables <auth method>   -> disable an authentication method
vault auth list                     -> lists the enabled authentication methods
vault login -method=<auth method>   -> login using a specific authentication method
```
Policy
------
```
vault policy write <policy name> - << EOF <policy> EOF  -> create a new policy
vault policy read <policy name>                         -> read the specified policy
vault policy list                                       -> lists the availabe policies
```
